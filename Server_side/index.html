<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Stream My Auto</title>

        <!-- Bootstrap CSS -->
        <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.0/jquery.mobile.structure-1.4.0.min.css" />

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>

        <style type="text/css">
            body{
                background-color: black;
                color:white;
            }
            #stream {
                height: 99%;
                margin: 0px auto;
                display: block;
                margin-top: 20px;
            }
            #datiauto h1 {
                font-size:6em;
            }
            h1#gear {
                font-size:10em;
            }
        </style>

        <!-- jQuery -->
        <script src="http://code.jquery.com/jquery.js"></script>
        <!-- Bootstrap JavaScript -->
        <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="http://clkweb.it/bootstrap-progressbar.js"></script>
        <script>
  
            $(document).on('ready' , function(){
                $('#progressbar').progressbar('setPosition', 85);
                var socket = io();
                socket.on('datiauto', function(gear,speed,laptime,rpm) {
                    $('#speed').html(speed+" Km/h");
                    $('#gear').html(gear);
                    $('#laptime').html(laptime);
                    $('#rpm').html(rpm);
                    var rpm = parseInt(rpm);
                    calcrpm(rpm);
                    // console.log(data);
                });
                function calcrpm(rpm){  //UNA VERA MERDATA >>>DA RIVEDERE COMPLETAMENTE
                    // alert(rpm);
                    if (rpm > 7900){
                        $('#progressbar').progressbar('setPosition', 100);
                        exit
                    }
                    else if (rpm > 4000){
                        $('#progressbar').progressbar('setPosition', 30);
                        exit
                    }
    
                    else if (rpm > 5000){
                        $('#progressbar').progressbar('setPosition', 40);
                        exit
                    }
                    else if (rpm > 5500){
                        $('#progressbar').progressbar('setPosition', 50);
                        exit
                    }
                    else if (rpm > 6000){
                        $('#progressbar').progressbar('setPosition', 55);
                        exit
                    }
                    else if (rpm > 6500){
                        $('#progressbar').progressbar('setPosition', 60);
                        exit
                    }
                    else if (rpm > 6800){
                        $('#progressbar').progressbar('setPosition', 65);
                        exit
                    }
                    else if (rpm > 7300){
                        $('#progressbar').progressbar('setPosition', 70);
                        exit
                    }
                    else if (rpm > 7500){
                        $('#progressbar').progressbar('setPosition', 75);
                        exit
                    }
                    else if (rpm > 7700){
                        $('#progressbar').progressbar('setPosition', 80);
                        exit
                    }
                    else if (rpm > 7800){
                        $('#progressbar').progressbar('setPosition', 90);
                        exit
                    }
                    else
                    {
                        $('#progressbar').progressbar('setPosition', 10);
                    }
                }
                function startStream() {
                    var data = 'ciaoo';
                    var canvas = $("#canvas");
                    var ctx = canvas.get()[0].getContext('2d');
                    socket.emit('start-stream', data);
                    $('.start').hide();
                }
                function stopStreaming() {
                    socket.emit('stop-stream');
                    $('.start').hide();
                }
  
            })
  
        </script>
    </head>

    <body class="container">
        <h1 class="text-center">Dati Auto
            <small>beta</small>
        </h1>

        <hr>


        <div class="row">
            <img src="" id="stream">
        </div>
        <div id="datiauto">

            <div id="progressbar">
            </div>
            <h2 id="rpm"></h2>
            <h1 id="gear"></h1>
            <h1 id="speed"></h1>
            LAPTIME:
            <h2 id="laptime">@ BOX</h2>
        </div>
        <div>
            <video id="live" width="420" height="340" autoplay style="display: inline;"></video>
            <canvas width="420" id="canvas" height="340" style="display: inline;"></canvas>
        </div>

        <script type="text/javascript">
            $('#progressbar').progressbar({
                warningMarker: 60,
                dangerMarker: 80,
                maximum: 100,
                step: 5
            });
        </script>
    </body>

</html>
